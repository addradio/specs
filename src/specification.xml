<?xml version="1.0" standalone="no"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2.0//EN" "http://docbook.org/xml/4.2/docbookx.dtd">

<book xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Technical specification for interfacing with the AddRadio network</title>
    <chapter>
        <title>General communication with Icecast2</title>
        <para>Communication with Icecast2 is based on HTTP. Icecast2 implements HTTP/1.0 with a set of features from HTTP/1.1 and some usecase specific extensions. In addition Icecast2 may support other protocols such as ICY.</para>
        <section>
            <title>Protocol Specification</title>
            <para>All Icecast2 clients connect to Icecast2 using the same server address. Mountpoints and general web access uses administrator provided resource names. The administration interface and API is available below the resource prefix "/admin".</para>
            <para>Icecast2 implements HTTP/1.0. It understands most HTTP/1.1 requests. If interpretation of a request fails Icecast2 will send a HTTP/1.0 error reply depending on the reason of failure. If Icecast2 can not assume a HTTP client or the error occurs in early stages of client handling Icecast2 may drop the connection without sending data to the client.</para>
            <section>
                <title>Request headers</title>
                <para>Any kind of client must send a proper HTTP request. There are some header fields a client must or should include.</para>
                <formalpara>
                    <title>Mandatory header fields</title>
                    <variablelist>
                        <varlistentry>
                            <term><code>Host:</code></term>
                            <listitem><para>Any client must send a <code>Host:</code>-header. If the underlying transport supports ports the port must be given in the header. The client must send the <code>Host:</code>-headr als the first header after the request line. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7230#section-5.4">RFC 7230 Section 5.4</link> stay valid.</para></listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><code>Accept:</code></term>
                            <listitem><para>Any client must send a <code>Accept:</code>-header listening acceptable content encodings. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7231#section-5.3.2">RFC 7231 Section 5.4.2</link> stay valid.</para></listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><code>User-Agent:</code></term>
                            <listitem><para>Any cliet must send a <code>User-Agent:</code>-header. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7231#section-5.5.3">RFC 7231 Section 5.5.3</link> stay valid.</para></listitem>
                        </varlistentry>
                    </variablelist>
                </formalpara>
                <formalpara>
                    <title>Optional header fields</title>
                    <variablelist>
                        <varlistentry>
                            <term><code>Referer:</code></term>
                            <listitem><para>Any client that was directed to the requested resource by another resource must include a <code>Referer:</code>-header. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7231#section-5.5.2">RFC 7231 Section 5.5.2</link> stay valid.</para></listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><code>From:</code></term>
                            <listitem><para>Any client may send a <code>From:</code>-header to allow contacting the operator in case of problems. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7231#section-5.5.1">RFC 7231 Section 5.5.1</link> stay valid.</para></listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><code>Accept-Charset:</code></term>
                            <listitem><para>All clients should send a <code>Accept-Charset:</code>-header to inform the server about charsets the client supports. Every client must support UTF-8. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7231#section-5.3.3">RFC 7231 Section 5.3.3</link> stay valid.</para></listitem>
                        </varlistentry>
                        <varlistentry>
                            <term><code>Accept-Language:</code></term>
                            <listitem><para>All clients should send a <code>Accept-Language:</code>-header. This allows to the server to select a response in a language understood by the operator. All other considerations of <link xlink:href="https://tools.ietf.org/html/rfc7231#section-5.5.5">RFC 7231 Section 5.5.5</link> stay valid.</para></listitem>
                        </varlistentry>
                    </variablelist>
                </formalpara>
            </section>
            <section>
                <title>Status codes</title>
                <para>The server may respond with any <link xlink:href="https://tools.ietf.org/html/rfc7231#section-6">RFC 7231 Section 6</link> status code. Below is a incomplete list of important status codes:
                    <table>
                        <tgroup rowsep="0">
                            <colspec colname="statuscode" />
                            <colspec colname="statustext" />
                            <colspec colname="uuid" />
                            <colspec colname="body" />
                            <spanspec spanname="textspan" namest="statuscode" nameend="body" rowsep="1" />

                            <thead>
                                <row>
                                    <entry>Status Code</entry>
                                    <entry>Reason Phrase</entry>
                                    <entry>UUID</entry>
                                    <entry>Body</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Description</entry>
                                </row>
                            </thead>

                            <tbody>
                                <!-- Informational responses -->
                                <row>
                                    <entry>100</entry>
                                    <entry>Continue</entry>
                                    <entry></entry>
                                    <entry>none</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Is sent if client requested it by adding the corresponding header to its request: <code>Expect: 100-continue</code>. See also Section <emphasis>100-continue</emphasis>.</entry>
                                </row>
                                <row>
                                    <entry>101</entry>
                                    <entry>Switching Protocols</entry>
                                    <entry></entry>
                                    <entry>none</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">This is sent by the server when the server performs a protocol switch as requested by the client. This may happen e.g. in <emphasis>RFC 2818 mode</emphasis>.</entry>
                                </row>

                                <!-- Success -->
                                <row>
                                    <entry>200</entry>
                                    <entry>OK</entry>
                                    <entry></entry>
                                    <entry>depending on request</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Sent after source client stopped</entry>
                                </row>
                                <row>
                                    <entry>206</entry>
                                    <entry>Partial Content</entry>
                                    <entry></entry>
                                    <entry>depending on request</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The server's replies with a range from a range request. See <link xlink:href="https://tools.ietf.org/html/rfc7233#section-4.1">RFC 7233 Section 4.1</link> for details.</entry>
                                </row>

                                <!-- Client errors -->
                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>1ae45ead-40fc-4de2-b56f-e54d3247f2ee</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Source's mountpoint does not begin with a slash ("/").</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>2cd86778-ac30-49e7-a108-26d627a7923b</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Header field <code>Content-Type</code> was not set but is mandatory. See also Section <emphasis>Content Types</emphasis>.</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>ec16f654-f262-415f-ab91-95703ae33704</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The client tried to upgrade to a protocol the server is not willing to upgrade to.</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>811bddac-5be5-4580-9cde-7b849e66dfe5</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The client sent an unrecognized API or admin command.</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>cb11dc71-6149-454c-8d4e-47a3af26b03a</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The request misses a GET or POST parameter that is required for request.</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>00b9d977-f41d-455f-820f-6d457dffb246</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">API or admin request on a source that exists but is not available at this point.</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>52735a81-16fe-4d7e-9984-5aed8a941055</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">API or admin request with destination source not available.</entry>
                                </row>

                                <row>
                                    <entry>400</entry>
                                    <entry>Bad Request</entry>
                                    <entry>4be9a010-7a3f-44e4-b74d-3c6d9c4f7236</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">API or admin request points to same source for source and destination.</entry>
                                </row>

                                <row>
                                    <entry>401</entry>
                                    <entry>Authentication Required</entry>
                                    <entry>25387198-0643-4577-9139-7c4f24f59d4a</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">No or invalid authentication data was provided. See also Section <emphasis>Authentication</emphasis>.</entry>
                                </row>

                                <row>
                                    <entry>404</entry>
                                    <entry>File Not Found</entry>
                                    <entry>18c32b43-0d8e-469d-b434-10133cdd06ad</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The requested resource was not found on the server.</entry>
                                </row>

                                <row>
                                    <entry>404</entry>
                                    <entry>File Not Found</entry>
                                    <entry>f966870a-e3d1-4a33-a728-f0cbac0b90f3</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Source related API or admin command not found.</entry>
                                </row>

                                <row>
                                    <entry>404</entry>
                                    <entry>File Not Found</entry>
                                    <entry>a96442e7-ca74-4ef7-8fcf-69ed057a5841</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Global API or admin command not found.</entry>
                                </row>

                                <row>
                                    <entry>404</entry>
                                    <entry>File Not Found</entry>
                                    <entry>2f51a026-02e4-4fe4-bf9d-cc16557b3b65</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Source does not exist.</entry>
                                </row>

                                <row>
                                    <entry>404</entry>
                                    <entry>File Not Found</entry>
                                    <entry>c5f1ee06-46a0-4697-9f01-6e9fc333d555</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Destination does not exist.</entry>
                                </row>

                                <row>
                                    <entry>404</entry>
                                    <entry>File Not Found</entry>
                                    <entry>59fe9c81-8c34-49ff-800f-7ec42ea498be</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Role not found.</entry>
                                </row>

                                <row>
                                    <entry>405</entry>
                                    <entry>Method Not Allowed</entry>
                                    <entry>78f590cc-8812-40d5-a4ef-17344ab75b35</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The client used a method that was not understood by the server or is not allowed on the requested resource.</entry>
                                </row>

                                <row>
                                    <entry>409</entry>
                                    <entry>Conflict</entry>
                                    <entry>c5724467-5f85-48c7-b45a-915c3150c292</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The client sent a request for creation or manipulation of a mountpoint that already exists.</entry>
                                </row>

                                <row>
                                    <entry>415</entry>
                                    <entry>Unsupported Media Type</entry>
                                    <entry>f684ad3c-513b-4d87-9a66-424788bc6adb</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Client's Content-Type is not supported by the server.</entry>
                                </row>

                                <row>
                                    <entry>416</entry>
                                    <entry>Request Range Not Satisfiable</entry>
                                    <entry>5874cc51-770b-42b5-82d2-737b2b406b30</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The range that was requested by the client can not be satisfied by the server.</entry>
                                </row>

                                <row>
                                    <entry>426</entry>
                                    <entry>Upgrade Required</entry>
                                    <entry></entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The client send the request using a protocol that is not permitted for the request. The client is required to upgrade the the protocol listed in the <code>Upgrade:</code>-Header.</entry>
                                </row>

                                <row>
                                    <entry>429</entry>
                                    <entry>Too Many Requests</entry>
                                    <entry>9c72c1ec-f638-4d33-a077-6acbbff25317</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The request was declined by the server as the client reached the concurrent connection limit of the used credentials.</entry>
                                </row>

                                <!-- Server errors -->
                                <row>
                                    <entry>500</entry>
                                    <entry>Internal Server Error</entry>
                                    <entry>47a4b11b-5d2a-46e2-8948-942e7b0af3e6</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The server was unable to allocate the format.</entry>
                                </row>

                                <row>
                                    <entry>500</entry>
                                    <entry>Internal Server Error</entry>
                                    <entry>cda8203e-f237-4090-8d43-544efdd6295c</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The server was unable to reallocate internal buffers.</entry>
                                </row>

                                <row>
                                    <entry>500</entry>
                                    <entry>Internal Server Error</entry>
                                    <entry>a8b3c3fe-cb87-45fe-9a9d-ee4c2075d43a</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The server was unable to generate headers for a proper response.</entry>
                                </row>

                                <row>
                                    <entry>500</entry>
                                    <entry>Internal Server Error</entry>
                                    <entry>d3c6e4b3-7d6e-4191-a81b-970273067ae3</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The server was unable to render a XSLT document.</entry>
                                </row>

                                <row>
                                    <entry>501</entry>
                                    <entry>Unimplemented</entry>
                                    <entry>3bed51bb-a10f-4af3-9965-4e67181de7d6</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">The source does not accept metadata updates via ABI or admin command.</entry>
                                </row>

                                <row>
                                    <entry>501</entry>
                                    <entry>Unimplemented</entry>
                                    <entry>7e1a8426-2ae1-4a6b-bfd9-59d8f8153021</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Adding new users to role not supported by role.</entry>
                                </row>

                                <row>
                                    <entry>501</entry>
                                    <entry>Unimplemented</entry>
                                    <entry>367fbad1-389e-4292-bba8-c97984e616cc</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Deleting users from role not supported by role.</entry>
                                </row>

                                <row>
                                    <entry>501</entry>
                                    <entry>Unimplemented</entry>
                                    <entry>58ce6cb4-72b4-49da-8ad2-feaf775bc61e</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Client sent an request with a Transfer-Encoding not supported by the server.</entry>
                                </row>

                                <row>
                                    <entry>503</entry>
                                    <entry>Service Unavailable</entry>
                                    <entry>26708754-8f98-4191-81d1-7fb7246200d6</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Server is currently busy. Try again later.</entry>
                                </row>

                                <row>
                                    <entry>503</entry>
                                    <entry>Service Unavailable</entry>
                                    <entry>c770182d-c854-422a-a8e5-7142689234a3</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Too many source are currently connected. Try again later.</entry>
                                </row>

                                <row>
                                    <entry>503</entry>
                                    <entry>Service Unavailable</entry>
                                    <entry>87fd3e61-6702-4473-b506-f616d27a142f</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Too many clients are currently connected. Try again later.</entry>
                                </row>

                                <row>
                                    <entry>503</entry>
                                    <entry>Service Unavailable</entry>
                                    <entry>18411e73-713e-4910-b7e4-52a2e324b4e0</entry>
                                    <entry>Error report</entry>
                                </row>
                                <row>
                                    <entry spanname="textspan">Memory exhausted. Try again later.</entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>
            </section>
            <section>
                <title>Authentication</title>
                <para>Depending on operation and resource Icecast2 may require the client to authenticate. If such a resource is accessed in such a operation and no authentication data was sent along with the request Icecast2 will respond with the corresponding error status.</para>
                <para>Authentication is based on <link xlink:href="https://tools.ietf.org/html/rfc7617">RFC 7617</link>. The client must send a request with no authentication first. The server will include information in it's error response on how to provide authentication data correctly. This step may be skipped according to the rules in RFC 7617 only.</para>
                <para>The client must support the "Basic" authentication scheme.</para>
            </section>
            <section>
                <title>Transfer encodings</title>
                <para>Icecast2 supports different transfer encodings for sending data to Icecast2. A client is free to choice any of what is supported by the server. An application must consider what transfer encodings are announced by the server.</para>
                <para>The transfer encoding is announced by the server using the <code>Accept-Encoding</code> HTTP header.</para>
                <table>
                    <thead>
                        <row>
                            <entry>Encoding</entry>
                            <entry>min. Icecast2 version</entry>
                            <entry>Comment</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>identity</entry>
                            <entry>Icecast2 2.0.0</entry>
                            <entry>This is the safe fallback.</entry>
                        </row>
                        <row>
                            <entry>chunked</entry>
                            <entry>Icecast2 2.5.0-beta.1</entry>
                            <entry></entry>
                        </row>
                    </tbody>
                </table>
                <warning>Prior to Icecast2 2.5.0-beta.1 the server did not return error in case a unsupported transfer encoding was used by the client. Those servers only support the "identity" encoding.</warning>
                <note>RFC 7230 removed the "identity" encoding from the standard. See <link xlink:href="https://tools.ietf.org/html/rfc7230#appendix-A.2">RFC 7230 Appendix A.2</link> for details.</note>
                <tip>
                    <para>
                        When chunked is not used as outermost transfer encoding the client can half-close the connection to signal the end of the request if the transport supports half-closed connections.
                    </para>
                    <para>
                        On IEEE Std 1003.1 ("POSIX") systems this can be achieved calling <function>shutdown</function> with <constant>SHUT_WR</constant>.
                    </para>
                </tip>
            </section>

            <section>
                <title>Metadata</title>
                <para>Metadata is an important part of modern audio and video streaming. With Icecast2 metadata are transported as part of the transported datastream. All supported formats support metadata. Only for non-supported MP3 and AAC (and derivates) streams the ICY protocol must be used. This protocol is not part of this specification. For details see the corresponding documentation of the used streaming format. For ICY see the appendix in this document.</para>
            </section>
        </section>

        <section>
            <title>TLS</title>
            <para>Icecast2 has TLS support included. Available TLS versions and options depend on the actual deployment. The following modes are supported:
                <table>
                    <thead>
                        <row>
                            <entry>Mode</entry>
                            <entry>min. Icecast2 version</entry>
                            <entry>Comment</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>RFC 2817</entry>
                            <entry>Icecast2 2.3.2</entry>
                            <entry>HTTP over TLS</entry>
                        </row>
                        <row>
                            <entry>RFC 2818</entry>
                            <entry>Icecast2 2.5.0-beta.1</entry>
                            <entry>Upgrade to TLS within HTTP<footnote><para>This is similar to what other protocols call "STARTTLS".</para></footnote></entry>
                        </row>
                    </tbody>
                </table>
            </para>
            <note>Some older documentation may call TLS SSL.</note>
        </section>

        <section>
            <title>Content Types</title>
            <para>The following content types are support for streaming. Other content types my be used for non-streaming resources such as the administration interface and the API.</para>
            <table>
                <title>Mine Types</title>
                <thead>
                    <row>
                        <entry>Mime Type</entry>
                        <entry>Container</entry>
                        <entry>Codecs</entry>
                        <entry>min. Icecast2 version</entry>
                        <entry>Comment</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>application/x-ogg</entry>
                        <entry>Ogg</entry>
                        <entry><emphasis>See application/ogg</emphasis></entry>
                        <entry>Icecast2 2.0.0</entry>
                        <entry>For backwards compatibility only. Do not use in new applications.</entry>
                    </row>
                    <row>
                        <entry>application/ogg</entry>
                        <entry>Ogg</entry>
                        <entry>Vorbis, Opus, FLAC, Speex, MIDI, Theora, Kate, Skeleton</entry>
                        <entry>Icecast2 2.3.2</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>audio/ogg</entry>
                        <entry>Ogg</entry>
                        <entry>Vorbis, Opus, FLAC, Speex, MIDI, Skeleton</entry>
                        <entry>Icecast2 2.3.2</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>video/ogg</entry>
                        <entry>Ogg</entry>
                        <entry>Vorbis, Opus, FLAC, Speex, MIDI, Theora, Kate, Skeleton</entry>
                        <entry>Icecast2 2.3.2</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>audio/webm</entry>
                        <entry>WebM</entry>
                        <entry><emphasis>Any as per WebM specification</emphasis></entry>
                        <entry>Icecast2 2.4.0-beta.1</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>video/webm</entry>
                        <entry>WebM</entry>
                        <entry><emphasis>Any as per WebM specification</emphasis></entry>
                        <entry>Icecast2 2.4.0-beta.1</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>audio/x-matroska</entry>
                        <entry>Matroska</entry>
                        <entry><emphasis>Any as per Matroska specification</emphasis></entry>
                        <entry>Icecast2 2.4.0-beta.1</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>video/x-matroska</entry>
                        <entry>Matroska</entry>
                        <entry><emphasis>Any as per Matroska specification</emphasis></entry>
                        <entry>Icecast2 2.4.0-beta.1</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>video/x-matroska-3d</entry>
                        <entry>Matroska</entry>
                        <entry><emphasis>Any as per Matroska specification</emphasis></entry>
                        <entry>Icecast2 2.4.0-beta.1</entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>audio/mpeg</entry>
                        <entry>MP3</entry>
                        <entry><emphasis>ignored</emphasis></entry>
                        <entry>Icecast2 2.0.0</entry>
                        <entry>Handled as <emphasis>any other</emphasis> since Icecast2 2.2.0.</entry>
                    </row>
                    <row>
                        <entry><emphasis>any other</emphasis></entry>
                        <entry>MP3, AAC, NSV</entry>
                        <entry><emphasis>ignored</emphasis></entry>
                        <entry>Icecast2 2.2.0</entry>
                        <entry>Deprecated. Handled using a generic format handler.</entry>
                    </row>
                </tbody>
            </table>
            <table>
                <title>Codecs</title>
                <thead>
                    <row>
                        <entry>Codec</entry>
                        <entry>Containers</entry>
                        <entry>min. Icecast2 version</entry>
                        <entry>Comment</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Vorbis</entry>
                        <entry>Ogg, WebM, Matroska</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>Opus</entry>
                        <entry>Ogg, WebM, Matroska</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>FLAC</entry>
                        <entry>Ogg</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>Speex</entry>
                        <entry>Ogg</entry>
                        <entry></entry>
                        <entry>Deprecated.</entry>
                    </row>
                    <row>
                        <entry>MIDI</entry>
                        <entry>Ogg</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>Theora</entry>
                        <entry>Ogg</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>Kate</entry>
                        <entry>Ogg</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry>Skeleton</entry>
                        <entry>Ogg</entry>
                        <entry></entry>
                        <entry></entry>
                    </row>
                    <row>
                        <entry><emphasis>any other</emphasis></entry>
                        <entry>WebM, Matroska</entry>
                        <entry></entry>
                        <entry>Supported as per container specification.</entry>
                    </row>
                </tbody>
            </table>
        </section>
    </chapter>
    <chapter>
        <title>Ingesting Source Streams to Icecast2</title>
        <para>Ingesting source streams to Icecast2 is implemented by sending a HTTP PUT to the mountpoint of the given stream. The server will then try to create the stream automatically based on the provided data and it's configuration.</para>
        <note>HTTP PUT was implemented in Icecast2 2.4.0-beta.2. Before that a custom extension was used using the HTTP method "SOURCE".</note>
        <section>
            <title>Protocol Specification</title>
            <section>
                <title>Overview</title>
                <para>Sending data to the server is done by:
                    <orderedlist>
                        <listitem><para>Optionally a TLS connection is established between client and server.</para></listitem>
                        <listitem><para>A PUT request is sent by the client without authentication data.</para></listitem>
                        <listitem><para>Optionally the server may refuse the request if authentication is required.</para></listitem>
                        <listitem><para>If the server refused the request because of missing authenticationtThe client then repeats the request with authentication data provided.</para></listitem>
                        <listitem><para>Optionally the server replies with a 100-continue message.</para></listitem>
                        <listitem><para>The client sends the stream in negotiated transfer encoding.</para></listitem>
                        <listitem><para>The server replies with a final 200-OK.</para></listitem>
                        <listitem><para>Client and server terminate the connection.</para></listitem>
                    </orderedlist>
                </para>
            </section>
            <section xml:id="S100continue">
                <title xml:id="S100continue.title">100-continue</title>
                <para>The client should ask the server to send a 100-continue reply. This allows the server to reject the stream cleanly in case there is any problem. Such problems could be e.g. mismatch of credentials or unsupported parameters. Then the 100-continue reply is requested the server may reply with a 100-continue. The client should wait a reasonable long time before starting to provide data if no reply has been received yet.</para>
                <para>The 100-continue reply is requested by adding the following header to the request header:</para>
                <programlisting>Expect: 100-continue</programlisting>
                <warning>Up to Icecast2 2.4.3 there is a bug that causes the TLS connection to be abnormally terminated when using 100-continue and TLS. This has been fixed in Icecast2 2.4.4 and 2.5.0-beta.2.</warning>
            </section>
        </section>

        <section>
            <title>Examples</title>
            <para>This section lists example communication with an Icecast2 server for sending source streams. Information in &lt;&gt; are comments or special data.</para>
            <note>This section is not part of the specification.</note>
            <section>
                <title>Successful communication with Authentication and 100-continue</title>
                <para>This example demonstrates a successful communication between a Icecast2 server and a client using Authentication and 100-continue.</para>
                <formalpara>
                    <title>Client to server: Initial request without authentication</title>
                    <para>The client sends an initial request to the server. The request does not contain any authentication data.
                        <programlisting><![CDATA[PUT /example1.ogg HTTP/1.1
Host: localhost:8000
User-Agent: IceS 2.0.2
Content-Type: application/ogg
ice-public: 0
ice-name: Example stream name
ice-genre: Example genre
ice-description: A short description of your stream
ice-audio-info: samplerate=48000;channels=2;quality=3%2e00
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Server to client: Initial response requesting authentication</title>
                    <para>The server replies to the server with status 401 "Authentication Required". This asks the client to authenticate and provides required information.
                        <programlisting><![CDATA[HTTP/1.0 401 Authentication Required
Server: Icecast 2.4.99.3
Connection: Keep-Alive
Accept-Encoding: identity, chunked
Allow: GET, PUT, SOURCE
Date: Fri, 13 Apr 2018 08:16:31 GMT
Content-Type: text/plain; charset=utf-8
WWW-Authenticate: Basic realm="Icecast2 Server"
Cache-Control: no-cache
Expires: Mon, 26 Jul 1997 05:00:00 GMT
Pragma: no-cache
Access-Control-Allow-Origin: *
Content-Length: 26
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Close to server: Repeated request with authentication</title>
                    <para>The client repeats it's request with authentication data as per request by the server.
                        <programlisting><![CDATA[PUT /example1.ogg HTTP/1.0
Host: localhost:8000
Expect: 100-continue
Authorization: Basic c291cmNlOmhhY2ttZQ== <Base64 of "source:hackme">
User-Agent: IceS 2.0.2
Content-Type: application/ogg
ice-public: 0
ice-name: Example stream name
ice-genre: Example genre
ice-description: A short description of your stream
ice-audio-info: samplerate=48000;channels=2;quality=3%2e00
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Server to client: 100-continue</title>
                    <para>The server replies with a 100-continue. The client can now assume that the request is likely to pass and can send the body.
                        <programlisting><![CDATA[HTTP/1.1 100 Continue
Server: Icecast 2.4.99.3
Accept-Encoding: identity, chunked
Allow: GET, PUT, SOURCE
Date: Fri, 13 Apr 2018 08:31:25 GMT
Cache-Control: no-cache
Expires: Mon, 26 Jul 1997 05:00:00 GMT
Pragma: no-cache
Access-Control-Allow-Origin: *
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Client to server: Client sends data</title>
                    <para>The client sends the stream data as body of it's second PUT request.
                        <programlisting><![CDATA[<data>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Server to client: Final response to client</title>
                    <para>After the client finished the server acknowledges the request and data by returning a final 200-OK response.
                        <programlisting><![CDATA[HTTP/1.0 200 OK
Server: Icecast 2.4.99.3
Connection: Close
Accept-Encoding: identity, chunked
Allow: GET, PUT, SOURCE
Date: Fri, 13 Apr 2018 08:31:25 GMT
Cache-Control: no-cache
Expires: Mon, 26 Jul 1997 05:00:00 GMT
Pragma: no-cache
Access-Control-Allow-Origin: *
<blank line>]]></programlisting>
                    </para>
                </formalpara>
            </section>
        </section>
    </chapter>
    <chapter>
        <title>Accessing a Icecast2 stream as listener</title>
        <para>Listener clients (audio and video) request streams by using HTTP GET.</para>
        <section>
            <title>Protocol Specification</title>
            <para>Listener clients request the corresponding stream using HTTP GET. Clients should send a HTTP/1.1 request. Icecast2 will respond with the stream if the request is successful or corresponding error code if not. Icecast2 may also require the client to authenticate before allowing access.</para>
        </section>

        <section>
            <title>Examples</title>
            <section>
                <title>Successful communication without Authentication</title>
                <para>This example demonstrates a successful communication between a Icecast2 server and a client.</para>
                <formalpara>
                    <title>Client to server: Client requests the stream</title>
                    <para>The client sends it request for the given stream.
                        <programlisting><![CDATA[GET /example1.ogg HTTP/1.1
Host: localhost:8000
User-Agent: Wget/1.16 (linux-gnu)
Accept: */*
Connection: Keep-Alive
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Server to client: Response to client</title>
                    <para>The server does have the corresponding resource and allows access. Therefore it sends 200-OK and the content of the stream.
                        <programlisting><![CDATA[HTTP/1.0 200 OK
Server: Icecast 2.4.99.3
Connection: Close
Accept-Encoding: identity, chunked
Allow: GET, PUT, SOURCE
Date: Wed, 18 Apr 2018 10:10:54 GMT
Content-Type: application/ogg
Cache-Control: no-cache
Expires: Mon, 26 Jul 1997 05:00:00 GMT
Pragma: no-cache
Access-Control-Allow-Origin: *
ice-audio-info: samplerate=0;channels=0;quality=3%2e00
icy-description:A short description of your stream
icy-genre:Example genre
icy-name:Example stream name
icy-pub:0
<blank line>
<data>]]></programlisting>
                    </para>
                </formalpara>
            </section>
            <section>
                <title>Successful communication with Authentication</title>
                <para>This example demonstrates a successful communication between a Icecast2 server and a client. Authorization is used.</para>
                <formalpara>
                    <title>Client to server: The client requests the stream with no authentication</title>
                    <para>The client sends the request for the stream without authentication data provided.
                        <programlisting><![CDATA[GET /example1.ogg HTTP/1.1
Host: localhost:8000
User-Agent: Wget/1.16 (linux-gnu)
Accept: */*
Connection: Keep-Alive
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Server to client: Refusal of the request by the server</title>
                    <para>The server informs the client that the given resource requires authentication. It also provides the required information for that.
                        <programlisting><![CDATA[
HTTP/1.0 401 Authentication Required
Server: Icecast 2.4.99.3
Connection: Keep-Alive
Accept-Encoding: identity, chunked
Allow: GET, PUT, SOURCE
Upgrade: TLS/1.0
Date: Wed, 18 Apr 2018 12:08:30 GMT
Content-Type: text/plain; charset=utf-8
WWW-Authenticate: Basic realm="Icecast2 Server"
Cache-Control: no-cache
Expires: Mon, 26 Jul 1997 05:00:00 GMT
Pragma: no-cache
Access-Control-Allow-Origin: *
Content-Length: 26
<blank line>
You need to authenticate]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Client to server: The client resends the request with authentication</title>
                    <para>The client retries the request based on the provided information. It includes the authentication data as requested by the server.
                        <programlisting><![CDATA[GET /example1.ogg HTTP/1.1
Host: localhost:8000
User-Agent: Wget/1.16 (linux-gnu)
Accept: */*
Connection: Keep-Alive
Authorization: Basic bGlzdGVuZXI6aGFja21l <Base64 of "listener:hackme">
<blank line>]]></programlisting>
                    </para>
                </formalpara>
                <formalpara>
                    <title>Server to client: Final response to client</title>
                    <para>The server responds with the stream mounted on the provided resource.
                        <programlisting><![CDATA[HTTP/1.0 200 OK
Server: Icecast 2.4.99.3
Connection: Close
Accept-Encoding: identity, chunked
Allow: GET, PUT, SOURCE
Upgrade: TLS/1.0
Date: Wed, 18 Apr 2018 12:08:30 GMT
Content-Type: application/ogg
Cache-Control: no-cache
Expires: Mon, 26 Jul 1997 05:00:00 GMT
Pragma: no-cache
Access-Control-Allow-Origin: *
ice-audio-info: samplerate=0;channels=0;quality=3%2e00
icy-description:A short description of your stream
icy-genre:Example genre
icy-name:Example stream name
icy-pub:0
<blank line>
<data>]]></programlisting>
                    </para>
                </formalpara>
            </section>
        </section>
    </chapter>
    <chapter>
        <title>Accessing administration interface and API</title>
        <para>Both API and administration interface are mounted in the virtual directory <code>/admin</code> on the server. The administration interface is for administrator interaction only. It's pages are not machine readable. For machine readable access the API is used.</para>
        <para>The API defines serveral endpoints. Each endpoint provides access to a specific aspect of the server. Most endpoints return data as XML. Some endpoints may also return plain text. Most endpoints require data. Those data can be provided by the client as GET or POST parameters. POST must not be used if a server if a server does not post POST in the <code>Allow:</code>-header for that resource.</para>
        <tip>A client can try a request using POST and retry using GET if the requested failed.</tip>

        <section>
            <title>Common parameters</title>
            <variablelist>
                <varlistentry>
                    <term><code>mount</code></term>
                    <listitem><para>The mount parameter is used to select the mount the operation is applied to. For requests that list data this filters the list to the given mountpoint by selecting only the given one. This parameter most not be used more than once.</para></listitem>
                </varlistentry>
            </variablelist>
        </section>
    </chapter>
    <appendix>
        <title>Tested and Certified Source Clients</title>
    </appendix>

    <appendix>
        <title>ICY Protocol</title>
        <warning>This Appendix is informational only. It is not part of the specification.</warning>
        <para>The ICY source protocol is must not be used. The ICY listener protocol is however used for metadata transfer from Icecast2 to listeners for non-supported streaming formats such as MP3 and AAC. Those formats lack native support for metadata. Sources providing such formats to Icecast2 must use the described protocol using HTTP PUT. In addition they can use the corresponding API endpoint for metadata updates.</para>

        <section>
            <title>ICY listener protocol</title>
            <para>The ICY protocol is a protocol very similar to HTTP. Yet it is different protocol, not a HTTP dialect. ICY implements multiplexing actual data with metadata. To activate the ICY mode clients must pass the header <parameter>Icy-MetaData</parameter> set to <constant>1</constant> in the request. Icecast2 may reply with an ICY response including a <parameter>icy-metaint</parameter> header. If such a header is detected the client must switch to ICY mode. The response must not be interpreted as HTTP.</para>
            <para>In ICY mode Icecast2 will send a block of metadata every <parameter>icy-metaint</parameter> bytes of payload. The metadata frame consists of a length byte and the metadata string. The length byte is the first byte in the frame. The frame length is 16 times the value of the length byte not including the length byte itself. The remainder of the frame is the frame is the metadata string. The is application specific. However it is common that the string is in format <code>Key0='Value0';Key1='Value1';[...]</code>. Common keys are <parameter>StreamTitle</parameter> and <parameter>StreamUrl</parameter> defining the current title, and URL for the stream. The frame is 0-byte-padded. If metadata is not to be updated a frame with the length byte of 0 is generated.</para>
        </section>

        <section>
            <title>Metadata updates using API</title>
            <warning>This must not be used for streaming formats supporting metadata.</warning>
            <para>In order to update metadata for an ICY stream you must call the API endpoint <function>metadata</function>. The parameter <parameter>mount</parameter> must be set to the corresponding mount point. The parameter <parameter>mode</parameter> is set to the constant <constant>updinfo</constant>. The actual metadata are transported using the parameter <parameter>song</parameter>.</para>
            <formalpara>
                <title>Example URI</title>
                <programlisting><![CDATA[https://icecast.example.org:8000/admin/metadata?mount=%2Fmystream.mp3&mode=updinfo&song=My+Song+Title]]></programlisting>
            </formalpara>
        </section>
    </appendix>
</book>
